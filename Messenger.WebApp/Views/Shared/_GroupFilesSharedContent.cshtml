@model SharedContentDto

@* اضافه کردن BaseUrl برای ساخت صحیح آدرس فایل‌ها *@
@inject IConfiguration Configuration


<ul class="nav nav-tabs" id="groupFilesTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link @(Model.ActiveTab == "media-tab" ? "active" : "")" id="media-tab" data-bs-toggle="tab" data-bs-target="#media-tab-pane" type="button" role="tab" aria-controls="media-tab-pane" aria-selected="@(Model.ActiveTab == "media-tab" ? "true" : "false")">Media</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link @(Model.ActiveTab == "docs-tab" ? "active" : "")" id="docs-tab" data-bs-toggle="tab" data-bs-target="#docs-tab-pane" type="button" role="tab" aria-controls="docs-tab-pane" aria-selected="@(Model.ActiveTab == "docs-tab" ? "true" : "false")">Documents</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link @(Model.ActiveTab == "links-tab" ? "active" : "")" id="links-tab" data-bs-toggle="tab" data-bs-target="#links-tab-pane" type="button" role="tab" aria-controls="links-tab-pane" aria-selected="@(Model.ActiveTab == "links-tab" ? "true" : "false")">Links</button>
    </li>
</ul>

<div class="tab-content pt-3" id="groupFilesTabContent">
    <!-- Media Tab -->
    <div class="tab-pane fade @(Model.ActiveTab == "media-tab" ? "show active" : "")" id="media-tab-pane" role="tabpanel" aria-labelledby="media-tab">
        <div class="row g-3 files-container">
            @if (Model.MediaFiles != null && Model.MediaFiles.Any())
            {
                foreach (var file in Model.MediaFiles)
                {
                    var thumbnailUrl = !string.IsNullOrEmpty(file.FileThumbPath) ? $"{Model.BaseUrl}/{file.FileThumbPath}" : $"/{file.FilePath}";
                    <div class="col-4">
                        <div class="card file-card h-100">
                           
                            <div class="card-body">
                                <a href="#" style="text-align:center;">
                                    <img src="@thumbnailUrl" class="card-img-top file-thumbnail" alt="image file">
                                </a>
                               
                            </div>
                            <div class="card-footer">

                                <h6 class="card-title file-name text-truncate" title="@file.OriginalFileName">@file.OriginalFileName</h6>
                                <p class="card-text text-muted file-size d-inline">@FormatFileSize(file.FileSize)</p>

                                <a class="btn-download-file d-inline" data-file-id="@file.MessageFileId" href="#">
                                    <img src="~/chatzy/assets/iconsax/download.svg" class="" />&nbsp;
                                  
                                </a>

                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center p-4"><p>No media files found.</p></div>
            }
        </div>
    </div>

    <!-- Documents Tab -->
    <div class="tab-pane fade @(Model.ActiveTab == "docs-tab" ? "show active" : "")" id="docs-tab-pane" role="tabpanel" aria-labelledby="docs-tab">
        <ul class="list-group list-group-flush files-container">
            @if (Model.DocumentFiles != null && Model.DocumentFiles.Any())
            {
                foreach (var file in Model.DocumentFiles)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="file-icon-sm me-3"><i class="iconsax" data-icon="document-text-1"></i></div>
                            <div>
                                <div class="file-name fw-bold">@file.OriginalFileName</div>
                                <div class="file-size text-muted small">@FormatFileSize(file.FileSize)</div>
                            </div>
                        </div>
                       @*  <a href="#" class="btn btn-sm btn-outline-primary btn-download-file" data-file-id="@file.MessageFileId">
                            <i class="iconsax" data-icon="document-download"></i> Download
                        </a> *@
                        <a class="btn-download-file" data-file-id="@file.MessageFileId" href="#">
                            <img src="~/chatzy/assets/iconsax/download.svg" class="" />&nbsp;
                           @*  <span>Download</span> *@
                        </a>

                    </li>
                }
            }
            else
            {
                <li class="list-group-item text-center p-4">No documents found.</li>
            }
        </ul>
    </div>

    <!-- Links Tab -->
    <div class="tab-pane fade @(Model.ActiveTab == "links-tab" ? "show active" : "")" id="links-tab-pane" role="tabpanel" aria-labelledby="links-tab">
        <ul class="list-group list-group-flush files-container">
            @if (Model.Links != null && Model.Links.Any())
            {
                foreach (var link in Model.Links)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="file-icon-sm me-3"><i class="iconsax" data-icon="link"></i></div>
                            <a href="@link.LinkUrl" class="link-url text-truncate" target="_blank">@link.LinkUrl</a>
                        </div>
                    </li>
                }
            }
            else
            {
                <li class="list-group-item text-center p-4">No links found.</li>
            }
        </ul>
    </div>
</div>

@{
    // Helper function to format file size, similar to the JavaScript one
    string FormatFileSize(long bytes)
    {
        if (bytes == 0) return "0 Bytes";
        const int k = 1024;
        string[] sizes = { "Bytes", "KB", "MB", "GB", "TB" };
        int i = (int)Math.Floor(Math.Log(bytes) / Math.Log(k));
        return $"{Math.Round(bytes / Math.Pow(k, i), 1)} {sizes[i]}";
    }
}